<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="es"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Controller.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">AirBVJDOREST</a> &gt; <a href="index.source.html" class="el_package">es.deusto.bspq21e1.client.controller</a> &gt; <span class="el_source">Controller.java</span></div><h1>Controller.java</h1><pre class="source lang-java linenums">package es.deusto.bspq21e1.client.controller;

import java.util.ArrayList;
import java.util.Date;
import java.util.Locale;
import java.util.ResourceBundle;

import javax.ws.rs.client.Client;
import javax.ws.rs.client.ClientBuilder;
import javax.ws.rs.client.Entity;
import javax.ws.rs.client.Invocation;
import javax.ws.rs.client.WebTarget;
import javax.ws.rs.core.GenericType;
import javax.ws.rs.core.MediaType;
import javax.ws.rs.core.Response;
import javax.ws.rs.core.Response.Status;

import org.apache.log4j.Logger;

import es.deusto.bspq21e1.serialization.ReservationData;
import es.deusto.bspq21e1.serialization.UserData;
import es.deusto.bspq21e1.serialization.VanData;

public class Controller {

    private Client client;
    private WebTarget webTarget;
<span class="fc" id="L28">    private static Logger logger = Logger.getLogger(Controller.class.getName());</span>
    private ResourceBundle resourceBundle;
    private Locale currentLocale;
    
<span class="fc" id="L32">    public Controller(String hostname, String port) {</span>
<span class="fc" id="L33">    	client = ClientBuilder.newClient();</span>
<span class="fc" id="L34">    	webTarget = client.target(String.format(&quot;http://%s:%s/rest&quot;, hostname, port));</span>
<span class="fc" id="L35">    	resourceBundle = ResourceBundle.getBundle(&quot;SystemMessages&quot;, Locale.getDefault());</span>
<span class="fc" id="L36">    }</span>
    
    public ArrayList&lt;VanData&gt; searchVans(String location, String pickUpDate, String returnDate) {
<span class="fc" id="L39">    	WebTarget vansWebTarget = webTarget.path(&quot;AirBV/getVans/&quot; + location + &quot;/&quot; + pickUpDate + &quot;/&quot; + returnDate);</span>
    	
<span class="fc" id="L41">    	GenericType&lt;ArrayList&lt;VanData&gt;&gt; genericType = new GenericType&lt;ArrayList&lt;VanData&gt;&gt;() {};</span>
<span class="fc" id="L42">		ArrayList&lt;VanData&gt; list = vansWebTarget.request(MediaType.APPLICATION_JSON).get(genericType);</span>
		
<span class="fc" id="L44">		Invocation.Builder invocationBuilder =  vansWebTarget.request(MediaType.APPLICATION_JSON);</span>
<span class="fc" id="L45">		Response response = invocationBuilder.get();</span>
<span class="pc bpc" id="L46" title="1 of 2 branches missed.">		if(response.getStatus() == Status.OK.getStatusCode()) {</span>
<span class="fc" id="L47">			logger.info(&quot;Vans received to the controller.&quot;);</span>
<span class="fc" id="L48">			return list;</span>
		}else {
<span class="nc" id="L50">			logger.error(&quot;Error connecting with the server. Code: &quot; + response.getStatus());</span>
<span class="nc" id="L51">			logger.error(&quot;Error: &quot; + response.toString());</span>
		}
<span class="nc" id="L53">		return new ArrayList&lt;VanData&gt;();</span>
    }
    
    public boolean eraseUser(String dni) {
<span class="fc" id="L57">    	WebTarget eraseUserWebTarget = webTarget.path(&quot;AirBV/deleteUser/&quot; + dni);</span>
<span class="fc" id="L58">    	Invocation.Builder invocationBuilder = eraseUserWebTarget.request(MediaType.APPLICATION_JSON);</span>
    	
<span class="fc" id="L60">    	Response response = invocationBuilder.delete();</span>
<span class="pc bpc" id="L61" title="1 of 2 branches missed.">    	if (response.getStatus() != Status.OK.getStatusCode()) {</span>
<span class="nc" id="L62">    		logger.error(&quot;Error connecting with the server. Code: &quot; + response.getStatus());</span>
<span class="nc" id="L63">			logger.error(&quot;Error: &quot; + response.toString());</span>
<span class="nc" id="L64">			return false;</span>
		}
<span class="fc" id="L66">    	logger.info(&quot;User erased (message from controller)&quot;);</span>
<span class="fc" id="L67">    	return true;</span>
    }
    
    public boolean eraseVan(String licensePlate) {
<span class="fc" id="L71">    	WebTarget eraseVanWebTarget = webTarget.path(&quot;AirBV/deleteVan/&quot; + licensePlate);</span>
<span class="fc" id="L72">    	Invocation.Builder invocationBuilder = eraseVanWebTarget.request(MediaType.APPLICATION_JSON);</span>
    	
<span class="fc" id="L74">    	Response response = invocationBuilder.delete();</span>
<span class="fc bfc" id="L75" title="All 2 branches covered.">    	if (response.getStatus() != Status.OK.getStatusCode()) {</span>
<span class="fc" id="L76">    		logger.error(&quot;Error connecting with the server. Code: &quot; + response.getStatus());</span>
<span class="fc" id="L77">			logger.error(&quot;Error: &quot; + response.toString());</span>
<span class="fc" id="L78">			return false;</span>
		}
<span class="fc" id="L80">    	logger.info(&quot;Van erased (message from controller)&quot;);</span>
<span class="fc" id="L81">    	return true;</span>
    }
    
    public boolean cancelReservation(String code) {
<span class="fc" id="L85">    	WebTarget cancelReservationWebTarget = webTarget.path(&quot;AirBV/cancelReservation/&quot; + code); </span>
<span class="fc" id="L86">		Invocation.Builder invocationBuilder = cancelReservationWebTarget.request(MediaType.APPLICATION_JSON);</span>
		
<span class="fc" id="L88">		Response response = invocationBuilder.delete();</span>
<span class="fc bfc" id="L89" title="All 2 branches covered.">		if (response.getStatus() != Status.OK.getStatusCode()) {</span>
<span class="fc" id="L90">			logger.error(&quot;Error connecting with the server. Code: &quot; + response.getStatus());</span>
<span class="fc" id="L91">			logger.error(&quot;Error: &quot; + response.toString());</span>
<span class="fc" id="L92">			return false;</span>
		} else {
<span class="fc" id="L94">			logger.info(&quot;Reservation correctly cancelled&quot;);</span>
<span class="fc" id="L95">			return true;</span>
		}
    }
    
    public boolean registerUsers(String dni, String name, String email, String password) {
<span class="fc" id="L100">    	WebTarget registerUserWebTarget = webTarget.path(&quot;AirBV/registerUser&quot;); </span>
<span class="fc" id="L101">		Invocation.Builder invocationBuilder = registerUserWebTarget.request(MediaType.APPLICATION_JSON);</span>
		
<span class="fc" id="L103">    	UserData userData = new UserData();</span>
<span class="fc" id="L104">    	userData.setDni(dni);</span>
<span class="fc" id="L105">    	userData.setName(name);</span>
<span class="fc" id="L106">    	userData.setEmail(email);</span>
<span class="fc" id="L107">    	userData.setPassword(password);</span>
<span class="fc" id="L108">		Response response = invocationBuilder.post(Entity.entity(userData, MediaType.APPLICATION_JSON));</span>
<span class="pc bpc" id="L109" title="1 of 2 branches missed.">		if (response.getStatus() != Status.OK.getStatusCode()) {</span>
<span class="nc" id="L110">			logger.error(&quot;Error connecting with the server. Code: &quot; + response.getStatus());</span>
<span class="nc" id="L111">			logger.error(&quot;Error: &quot; + response.toString());</span>
<span class="nc" id="L112">			return false;</span>
		} else {
<span class="fc" id="L114">			logger.info(&quot;User correctly registered&quot;);</span>
<span class="fc" id="L115">			return true;</span>
		}
    }
    
    public UserData loginUser(String email, String password) {
<span class="fc" id="L120">    	WebTarget loginWebTarget = webTarget.path(&quot;AirBV/loginUser/&quot; + email + &quot;/&quot; + password);</span>
    	
<span class="fc" id="L122">    	GenericType&lt;UserData&gt; genericType = new GenericType&lt;UserData&gt;() {};</span>
<span class="fc" id="L123">    	UserData userData = loginWebTarget.request(MediaType.APPLICATION_JSON).get(genericType);</span>
    	
<span class="fc" id="L125">    	Invocation.Builder invocationBuilder = loginWebTarget.request(MediaType.APPLICATION_JSON);</span>
<span class="fc" id="L126">    	Response response = invocationBuilder.get();</span>
<span class="pc bpc" id="L127" title="1 of 2 branches missed.">    	if (response.getStatus() == Status.OK.getStatusCode()) {</span>
<span class="fc" id="L128">    		logger.info(&quot;User has logged in&quot;);</span>
<span class="fc" id="L129">    		return userData;</span>
    	} else {
<span class="nc" id="L131">    		logger.error(&quot;Error connecting with the server. Code: &quot; + response.getStatus());</span>
<span class="nc" id="L132">			logger.error(&quot;Error: &quot; + response.toString());</span>
    	}
<span class="nc" id="L134">    	return null;</span>
    }
    
    public boolean registerVan(VanData vanData) {
<span class="fc" id="L138">    	logger.debug(&quot;$ DEBUGGING:\n&quot; +</span>
				&quot;\tPrinting VanData and User from Controller in Client side:\n&quot;+
				&quot;\tVan: &quot; + vanData +
<span class="fc" id="L141">				&quot;\n\tUser: &quot; + vanData.getUser() +</span>
				&quot;\n=======================\n&quot;);
    	
<span class="fc" id="L144">    	WebTarget registerVanWebTarget = webTarget.path(&quot;AirBV/registerVan/&quot;+vanData.hasKitchen()+&quot;/&quot;+vanData.hasShower()); </span>
<span class="fc" id="L145">		Invocation.Builder invocationBuilder = registerVanWebTarget.request(MediaType.APPLICATION_JSON);</span>
<span class="fc" id="L146">		Response response = invocationBuilder.post(Entity.entity(vanData, MediaType.APPLICATION_JSON));</span>
<span class="fc bfc" id="L147" title="All 2 branches covered.">		if (response.getStatus() != Status.OK.getStatusCode()) {</span>
<span class="fc" id="L148">			logger.error(&quot;Error connecting with the server. Code: &quot; + response.getStatus());</span>
<span class="fc" id="L149">			logger.error(&quot;Error: &quot; + response.toString());</span>
<span class="fc" id="L150">			return false;</span>
		} else {
<span class="fc" id="L152">			logger.info(&quot;Van correctly registered&quot;);</span>
<span class="fc" id="L153">			return true;</span>
		}
    }
    
    public boolean registerReservation(Date bookingDate, int duration, VanData vanData, UserData vanRenter) {
<span class="fc" id="L158">    	WebTarget registerReservationWebTarget = webTarget.path(&quot;AirBV/registerReservation&quot;); </span>
<span class="fc" id="L159">		Invocation.Builder invocationBuilder = registerReservationWebTarget.request(MediaType.APPLICATION_JSON);</span>
		
<span class="fc" id="L161">    	ReservationData reservationData = new ReservationData();</span>
<span class="fc" id="L162">    	reservationData.setBookingDate(bookingDate);</span>
<span class="fc" id="L163">    	reservationData.setDuration(duration);</span>
<span class="fc" id="L164">    	reservationData.setVan(vanData.getLicensePlate());</span>
<span class="fc" id="L165">    	reservationData.setVanRenter(vanRenter.getDni());</span>
<span class="fc" id="L166">		Response response = invocationBuilder.post(Entity.entity(reservationData, MediaType.APPLICATION_JSON));</span>
<span class="fc bfc" id="L167" title="All 2 branches covered.">		if (response.getStatus() != Status.OK.getStatusCode()) {</span>
<span class="fc" id="L168">			logger.error(&quot;Error connecting with the server. Code: &quot; + response.getStatus());</span>
<span class="fc" id="L169">			logger.error(&quot;Error: &quot; + response.toString());</span>
<span class="fc" id="L170">			return false;</span>
		} else {
<span class="fc" id="L172">			logger.info(&quot;Reservation correctly registered&quot;);</span>
<span class="fc" id="L173">			return true;</span>
		}
    }

	public ArrayList&lt;ReservationData&gt; getMyReservations(UserData user) {		
<span class="fc" id="L178">		WebTarget reservationsWebTarget = webTarget.path(&quot;AirBV/getMyReservations/&quot; + user.getDni());</span>
		
<span class="fc" id="L180">		GenericType&lt;ArrayList&lt;ReservationData&gt;&gt; genericType = new GenericType&lt;ArrayList&lt;ReservationData&gt;&gt;() {};</span>
<span class="fc" id="L181">		ArrayList&lt;ReservationData&gt; list = reservationsWebTarget.request(MediaType.APPLICATION_JSON).get(genericType);</span>
		
<span class="fc" id="L183">		Invocation.Builder invocationBuilder =  reservationsWebTarget.request(MediaType.APPLICATION_JSON);</span>
<span class="fc" id="L184">		Response response = invocationBuilder.get();</span>
<span class="pc bpc" id="L185" title="1 of 2 branches missed.">		if(response.getStatus() == Status.OK.getStatusCode()) {</span>
<span class="fc" id="L186">			logger.info(&quot;Reservations well retrieved&quot;);</span>
<span class="fc" id="L187">			return list;</span>
		} else {
<span class="nc" id="L189">			logger.error(&quot;Error connecting with the server. Code: &quot; + response.getStatus());</span>
<span class="nc" id="L190">			logger.error(&quot;Error: &quot; + response.toString());</span>
		}
		
<span class="nc" id="L193">		return new ArrayList&lt;ReservationData&gt;();</span>
	}
	
	public ArrayList&lt;VanData&gt; getMyVans(String dni) {
<span class="fc" id="L197">		WebTarget vansWebTarget = webTarget.path(&quot;AirBV/getMyVans/&quot; + dni);</span>
		
<span class="fc" id="L199">		GenericType&lt;ArrayList&lt;VanData&gt;&gt; genericType = new GenericType&lt;ArrayList&lt;VanData&gt;&gt;() {};</span>
<span class="fc" id="L200">		ArrayList&lt;VanData&gt; list = vansWebTarget.request(MediaType.APPLICATION_JSON).get(genericType);</span>
		
<span class="fc" id="L202">		Invocation.Builder invocationBuilder = vansWebTarget.request(MediaType.APPLICATION_JSON);</span>
<span class="fc" id="L203">		Response response = invocationBuilder.get();</span>
<span class="pc bpc" id="L204" title="1 of 2 branches missed.">		if (response.getStatus() == Status.OK.getStatusCode()) {</span>
<span class="fc" id="L205">			logger.info(&quot;Van well retrieved&quot;);</span>
<span class="fc" id="L206">			return list;</span>
		} else {
<span class="nc" id="L208">			logger.error(&quot;Error connecting with the server. Code: &quot; + response.getStatus());</span>
<span class="nc" id="L209">			logger.error(&quot;Error: &quot; + response.toString());</span>
		}
<span class="nc" id="L211">		return null;</span>
	}
	
	/**
	 * Returns the ResourceBundle
	 * @return ResourceBundle
	 */
	public ResourceBundle getResourcebundle() {
<span class="nc" id="L219">		return resourceBundle;</span>
	}
	
	/**
	 * Sets the currentLocale
	 * @param locale
	 */
	public void setLocale(String locale){
<span class="nc bnc" id="L227" title="All 2 branches missed.">		if(locale.equals(&quot;es&quot;)){</span>
<span class="nc" id="L228">			currentLocale = new Locale(&quot;es&quot;);</span>
<span class="nc bnc" id="L229" title="All 2 branches missed.">		}else if(locale.equals(&quot;eu&quot;)){</span>
<span class="nc" id="L230">			currentLocale = new Locale(&quot;eu&quot;);</span>
<span class="nc bnc" id="L231" title="All 2 branches missed.">		}else if(locale.equals(&quot;en&quot;)){</span>
<span class="nc" id="L232">			currentLocale = new Locale(&quot;en&quot;);</span>
		}
		//TODO
<span class="nc" id="L235">	}</span>
	
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>